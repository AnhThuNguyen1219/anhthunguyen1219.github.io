<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Research</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    

    <body>
        <div class="survey"></div>
        <script src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js" type="text/javascript"></script>
        
        <!-- Start of Line script -->
        <script type="text/javascript">
            var _portalId = "564890345"; // Portal Bonaventura
            var _propId = "564995137"; //Event for 
            var _ATM_TRACKING_ASSOCIATE_UTM = 1 ;

            var div = document.getElementsByClassName("survey")[0];

            liff.init({ liffId: '2006455072-YkMDXbdA' }) //Liff ID when add a LIFF applications
                .then(async () => {
                    if (! liff.isLoggedIn()) {
                        liff.login();
                    }
                    const profile = await liff.getProfile();
                    const friendShip = await liff.getFriendship();
                    if(friendShip.friendFlag){
                        localStorage.setItem('LineUID', profile.userId);
                        //Start of CDP Web Insight script
                        (function() {
                            var w = window;
                            if (w.web_event) return;
                            var a = window.web_event = function() {
                                a.queue.push(arguments);
                            }
                            a.propId = _propId;
                            a.track = a;
                            a.queue = [];
                            var e = document.createElement("script");
                            e.type = "text/javascript", e.async = !0, e.src = "//st-a.cdp.asia/insight.js";
                            var t = document.getElementsByTagName("script")[0];
                            t.parentNode.insertBefore(e, t)
                        })();
                        //End of CDP Web Insight script

                        /** start tracking event: view_pageview */
                        web_event.track("pageview", "view", {
                            dims: {
                                "users": {
                                    "user_id" : profile.userId
                                }
                            },
                        });
                        /** end block */

                    }
                    else {
                        div.style = "font-size:30px;color: #004085;background-color: #cce5ff;border-color: #b8daff;padding:10px;margin:5px;"
                        div.innerHTML = "<i class='fa fa-info-circle' style='margin-right:10px;'></i>Please follow to submit this survey!";
                    }
                })
                .catch((err) => {
                    console.log(err);
                });
        </script>
        <!-- End of Line script -->
    </body>
</html>